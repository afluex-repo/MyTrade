@model MyTrade.Models.RechargeModel

@{
    ViewBag.Title = "DMT";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<script src="~/MyTradeWebsite/assets/js/bootstrap.bundle.min.js"></script>
<style>
    #content > .container {
        max-width: 100% !important;
    }

    .tab-content.payment-form {
        background-color: #ecf3f9;
        padding: 20px 20px;
    }

    .contact-form form .form-control, .contact-form form .form-select {
        background-color: #ffffff;
        border: none;
        -webkit-box-shadow: 0px 5px 28.5px 1.5px rgb(149 152 200 / 20%) !important;
        box-shadow: 0px 5px 28.5px 1.5px rgb(149 152 200 / 20%) !important;
        height: 50px;
        font-family: "Raleway", sans-serif;
        font-size: 14.5px;
    }

    .card-billrecharge .nav-tabs .nav-link.active {
        background: #910f10;
        color: #fff;
    }

    .card-billrecharge .nav-tabs .nav-link:hover {
        border: none;
        outline: none;
        background: #fff;
        color: #22396c;
    }

    .card-billrecharge .nav-tabs .nav-link {
        text-align: center;
        background: #22396c;
        color: #fff;
        height: 100%;
        width: 129.6px;
        padding: 15px 10px;
        outline: none;
        border: none;
    }

    .nav-tabs {
        border-bottom: none;
    }

    .tab-content .sub-title {
        display: block;
        margin-bottom: 10px;
        text-transform: capitalize;
        color: #22396c;
        font-size: 16px;
        font-family: "Raleway", sans-serif;
        font-weight: 700;
    }

    .section-title p {
        /* max-width: 500px; */
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 0;
    }

    .section-title .bar {
        height: 5px;
        width: 90px;
        background: #cdf1d8;
        margin: 15px auto 20px;
        position: relative;
        border-radius: 30px;
    }

    a:hover, a:focus {
        color: #f96332;
    }

    .plan {
        color: #e95108;
        outline: none;
        text-align: left;
    }

    .table td, .table th {
        border-top: none;
    }

    ._3H1N {
        background-color: #f8f8f8;
        font-size: 14px;
        overflow-x: scroll;
        display: -ms-flexbox;
        display: flex;
        color: #999;
        overflow: hidden;
        -o-text-overflow: ellipsis;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

        ._3H1N ._3HKw {
            padding: 12px 20px 12px 19px;
            cursor: pointer;
            color: black;
        }

        ._3H1N ._2Xj9 {
            color: #222;
            font-weight: 600;
            border-bottom: 3px solid #00b9f5;
            background: #f3f7f8;
        }

    ._262P {
        display: -ms-flexbox;
        display: flex;
        font-size: 13px;
        color: black;
        border-top: 1px solid #ebebeb;
        border-bottom: 1px solid #ebebeb;
    }

    .zUDk {
        width: 12%;
        padding: 7px 14px;
    }

    ._8nlz {
        height: 210px;
        overflow: scroll;
    }

    ._1aEZ:hover {
        background-color: #f3f7f8;
    }

    ._1aEZ {
        display: -ms-flexbox;
        display: flex;
        padding: 10px 0;
    }

    ._17KN {
        width: 15%;
    }

    ._3WAG {
        width: 37%;
        word-wrap: break-word;
    }

    ._3vjB {
        font-size: 14px;
        padding: 6px 10px;
    }

    .LLvJ {
        color: #00baf2;
        border: 1px solid #00baf2;
    }

    ._11kC {
        border-radius: 6px;
        margin: 0;
        text-align: center;
        font-weight: 600;
    }

    .contact-form form .help-block ul li {
        color: red;
        font-weight: 300;
    }

    .form-control::-webkit-input-placeholder {
        color: #888ea8;
        opacity: 1;
        white-space: pre-line;
        position: relative;
        top: -7px;
    }

    .loading-image {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200px;
        z-index: 10;
    }

    .loader {
        display: none;
        width: 200px;
        height: 200px;
        position: fixed;
        top: 50%;
        left: 50%;
        text-align: center;
        margin-left: -50px;
        margin-top: -100px;
        z-index: 2;
    }

    .loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background-color: transparent;
        z-index: 999999;
        transform: translateZ(999999px);
        display: none;
    }
    /*.overlay {
        display: none;
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 999;
        background: rgba(255,255,255,0.8) url('../../ProfilePicture/untitled-5.gif') center no-repeat;
    }
    /* Turn off scrollbar when body element has the loading class */
    /*body.loading {
        overflow: hidden;
    }

        body.loading .overlay {
            display: block;
        }*/
    /*.pageloader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url('../../ProfilePicture/untitled-5.gif') 50% 50% no-repeat rgb(249, 249, 249);
        opacity: .8;
    }*/
</style>
<div class="container">
    <div class="loader">
        <center>
            <img class="loading-image" src="~/ProfilePicture/untitled-5.gif" alt="loading..">
        </center>
    </div>
    <div class="row layout-top-spacing">
        <div class="col-lg-12 col-12 layout-spacing">
            <div class="statbox widget box box-shadow">
                <div class="widget-content widget-content-area">
                    <section class="how-it-works-area ptb-70">
                        <div class="row">
                            <div class="col-lg-12 col-sm-12 col-md-12">
                                <div class="card ">
                                    <div class="card-header ">
                                        <h4 class="card-title">Domestic Money Transfer</h4>
                                    </div>
                                    <div class="card-body ">
                                        <div class="col-md-4" id="content">
                                            <form>
                                                <div class="form-group">
                                                    <input type="number" id="number" maxlength="10" class="form-control" required="" onkeyup="keyGetSender(this);" name="number" placeholder="Mobile Number">
                                                </div>
                                                <input type="hidden" name="token" id="token" value="5fba90-b7cccf-0f4f30-0c82ed-8ca0ae">
                                                <div class="form-group GetSnd">
                                                    <div class="input-group">
                                                        <button type="submit" id="GetSnd" class="btn btn-primary btn-round col-md-12" onclick="clickGetSender(); return false;" disabled="disabled">Continue →</button>
                                                    </div>
                                                </div>


                                                <!-- create Sender-->

                                                <div class="form-group SenderName" style="display: none;">
                                                    <input type="text" id="SenderName" class="form-control" name="SenderName" placeholder="Name" required="">
                                                </div>

                                                <div class="form-group SenderSurname" style="display: none;">
                                                    <input type="text" id="SenderSurname" class="form-control" required="true" name="SenderSurname" placeholder="Surname">
                                                </div>

                                                <div class="form-group createNewSender" style="display: none;">
                                                    <div class="input-group">
                                                        <button type="submit" id="createNewSender" class="btn btn-primary btn-round col-md-12" onclick="createSender('YES'); return false;">Create Sender →</button>
                                                    </div>
                                                </div>
                                                <!--for verify user-->
                                                <input type="hidden" name="senderId" id="senderId">

                                                <div class="form-group otp-field" style="display: none;">
                                                    <input type="number" id="senderOtp" maxlength="6" class="form-control" required="true" onkeyup="verifySender(0,0,this.value);" name="senderOtp" placeholder="Enter OTP">
                                                </div>



                                                <div class="form-group verifyUser" style="display: none;">
                                                    <button type="submit" id="verifyUser" class="btn btn-primary btn-round col-md-12">Verify Sender →</button>
                                                </div>

                                            </form>
                                        </div>
                                        <div class="row">
                                            <div id="left_side" class="col-md-4" style="display: none;">


                                                <div class="form-group">
                                                    <div class="dropdown bootstrap-select form-control">
                                                        <select name="getForm" id="getForm" onchange="changeForm(this);" class="selectpicker form-control" data-size="7" data-style="btn-Custom_2nd btn-round" title="Choose Action" tabindex="-98">
                                                            <option class="bs-title-option" value=""></option>
                                                            <option value="trfMoney">Fund Transfer</option>
                                                            <option value="addBene">Add Beneficiary</option>
                                                        </select><button type="button" class="btn dropdown-toggle bs-placeholder btn-Custom_2nd btn-round" data-toggle="dropdown" role="button" data-id="getForm" title="Choose Action"><div class="filter-option"><div class="filter-option-inner"><div class="filter-option-inner-inner">Choose Action</div></div> </div></button><div class="dropdown-menu " role="combobox"><div class="inner show" role="listbox" aria-expanded="false" tabindex="-1"><ul class="dropdown-menu inner show"></ul></div></div>
                                                    </div>

                                                </div>


                                                <form id="trfMoney">
                                                    <div class="form-group">
                                                        <input type="number" id="accountNo" maxlength="10" name="accountNo" class="form-control" required="true" placeholder="Account Number" readonly="">
                                                    </div>



                                                    <div class="form-group">
                                                        <input type="text" id="bankName" class="form-control" name="bankName" required="true" placeholder="Bank Name" readonly="">
                                                    </div>


                                                    <div class="form-group">
                                                        <input type="text" id="benName" class="form-control" name="benName" required="true" placeholder="Accoount Holder" readonly="">
                                                    </div>

                                                    <div class="form-group">
                                                        <div class="dropdown bootstrap-select form-control">
                                                            <select name="mode" id="mode" class="selectpicker form-control" data-size="7" data-style="btn-Custom_2nd btn-round" tabindex="-98">
                                                                <option value="2" selected="">IMPS</option>
                                                                <option value="1">NEFT</option>
                                                            </select><button type="button" class="btn dropdown-toggle btn-Custom_2nd btn-round" data-toggle="dropdown" role="button" data-id="mode" title="IMPS"><div class="filter-option"><div class="filter-option-inner"><div class="filter-option-inner-inner">IMPS</div></div> </div></button><div class="dropdown-menu " role="combobox"><div class="inner show" role="listbox" aria-expanded="false" tabindex="-1"><ul class="dropdown-menu inner show"></ul></div></div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <div class="form-row">

                                                            <div class="col">
                                                                <input type="password" id="amounT" class="form-control" name="amounT" required="true" placeholder="Amount">
                                                            </div>

                                                            <div class="col">
                                                                <input type="number" id="camounT" class="form-control" name="camounT" required="true" placeholder="Confirm">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!--sender id-->
                                                    <input type="hidden" id="sID">
                                                    <input type="hidden" id="benID">

                                                    <div class="form-group ">
                                                        <div class="input-group">
                                                            <button type="submit" id="transferBtn" class="btn btn-primary btn-round col-md-12" disabled="disabled">Transfer <i class="fas fa-location-arrow"></i></button>
                                                        </div>
                                                    </div>
                                                </form>




                                                <form id="addBene" style="display: none;">

                                                    <div class="form-group">
                                                        <input type="text" id="Name" class="form-control" name="Name" required="true" placeholder="Name">
                                                    </div>


                                                    <div class="form-group">
                                                        <select id="lbanks" class="form-control" data-live-search="true" data-style="btn btn-Custom_2nd btn-round" data-size="5" onchange="setIfsc(this.value);">
                                                            <option value="NO">Select Bank</option>
                                                        </select>
                                                    </div>

                                                    <div class="form-group">
                                                        <input type="number" id="account" maxlength="10" name="account" class="form-control" required="true" placeholder="Account Number">
                                                    </div>






                                                    <div class="form-group">
                                                        <input type="text" id="ifsc" class="form-control" name="ifsc" required="true" placeholder="IFSC Code">
                                                    </div>


                                                    <!--sender id-->
                                                    <input type="hidden" value="" id="sID">
                                                    <input type="hidden" value="" id="mobile">
                                                    <input type="hidden" value="" id="mobile">

                                                    <div class="form-group ">
                                                        <div class="input-group">
                                                            <button type="submit" id="AddBene" class="btn btn-primary btn-round col-md-12">Add Beneficiary →</button>
                                                        </div>
                                                    </div>
                                                </form>


                                            </div>



                                            <div id="right_side" class="col-md-8" style="display: none;">
                                                <div class="row" style="border-bottom:1px solid #F2F2F2; padding-bottom: 5px;">
                                                    <div class="col-md-7">

                                                        <button class="btn btn-primary btn-sm" id="change_cust"><i class="fas fa-cogs"></i> Change Remitter</button>
                                                        <br>
                                                        Hi,<span id="dsname"></span>
                                                        <br>
                                                        <span id="dsmobile"></span>
                                                    </div>

                                                    <div class="col-md-5 text-right">
                                                        <font color="orange">Consumed Limit <i class="fa fa-inr" id="climit"></i></font><br>
                                                        <font color="green">Remaining Limit <i class="fa fa-inr" id="rlimit"></i></font><br>
                                                        Total Limit <i class="fa fa-inr" id="tlimit"></i>
                                                    </div>
                                                </div>
                                                <br>
                                                <div id="BenADD"></div>

                                            </div>
                                        </div>



                                    </div>


                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
<script language="JavaScript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
<script type="text/javascript">
    //global
    var process = '<i class="fa fa-spinner fa-spin" style="font-size: 15px;" aria-hidden="true"></i>Fetching...';
    var wait = '<i class="fa fa-spinner fa-spin" style="font-size: 15px;" aria-hidden="true"></i>Processing...';
    var fetched = '<i class="fa fa-eye" style="font-size: 15px;" aria-hidden="true"></i>Fetched';
    var tryAgain = '<i class="fa fa-eye" style="font-size: 15px;" aria-hidden="true"></i>Try Again';
    var tryTen = '<i class="fa fa-cross" style="font-size: 15px;" aria-hidden="true"></i>Plz Enter 10 digit mobile no';
    var $j = jQuery.noConflict();
    var tkn = $j("#token").val();

    var pop = function (stype, shtml) {
        Swal.fire({
            type: stype,
            html: shtml,
            timer: 2000,
            showConfirmButton: false,
        });
    };
    // calling swal
    $j("#change_cust").click(function () {
        swal.fire({
            title: 'Change Remitter?',

            html:
            '<div class="form-group">' +
            '<button  class="btn btn-warning btn-sm"><a style="color: inherit;" href="Dmt/index.php">Yes >></a></button></div>',
            showCloseButton: true,
            //showCancelButton: true,
            // customClass: 'getcust_swal',
            showConfirmButton: false,
            allowOutsideClick: false,
            focusConfirm: false,
            allowEscapeKey: false,

        })
    });

    $j(function () {
        $("#GetSnd,#transferBtn").attr('disabled', true);


        //get banks
        /*
         $.ajax({
                   url: '../../app_v2/Dmt/bank_list.php',
                   method: 'POST',
                   dataType: "json",
                   data:{api_token:tkn},
                   success: function(getResp){
                         var success=getResp['success'];
                         var data=getResp['data'];
                         //console.log(getResp);
                         if(success==true){
                           $.each(data,function(index,value){

                             $("#lbanks").append("<option value="+value['ifsc']+">"+value['bank_name']+"</option>");

                           });

                         }else{
                           alert("oops");
                         }
                  },
                   error: function(){
                       alert("bank err");
                   }
                   });
                   */
        //end get bank list

        //check confirm amount
        $("#camounT,#amounT").keyup(function () {
            amt = $("#amounT").val();
            camt = $("#camounT").val();

            if ((camt > 5000) || (amt > 5000)) {
                $("#transferBtn").html("Maximum <i class='fas fa-rupee-sign'></i>5000/Txn Allowed.");
                $("#transferBtn").attr('disabled', true);
            } else if (amt == camt) {
                $("#transferBtn").attr('disabled', false);
                $("#transferBtn").html("Transfer <i class='fas fa-location-arrow'></i>");
            } else if (amt != camt) {
                $("#transferBtn").html("Confirm Amount Mismatch <i class='fas fa-times'></i>");
                $("#transferBtn").attr('disabled', true);
            }
            else {
                $("#transferBtn").html("Amount Field Empty <i class='fas fa-times'></i>");
            }
        });
        //end camt

        //transfer money
        $("#trfMoney").submit(function () {
            var sid = $("#sID").val();
            var bid = $("#benID").val();
            var acNo = $("#accountNo").val();
            var amt = $("#camounT").val();
            var mob = $("#mobile").val();
            var mode = $("#mode").val();
            var pid = '16555409136033';
            var way = 'WEB';

            $("#transferBtn").attr('disabled', true);
            $("#transferBtn").html(wait);

            swal.fire({
                html: '<div id="trfWait"><i class="fa fa-spinner fa-spin" style="font-size: 15px;" aria-hidden="true"></i>Requesting to Bank...</div>',
                customClass: 'normal_swal',
                showConfirmButton: false,
                showCloseButton: false,
                allowOutsideClick: false,
                allowEscapeKey: false,
            });

            $.ajax({
                url: '../../app_v2/Dmt/transfer.php',
                method: 'POST',
                dataType: "json",
                data: {
                    api_token: tkn,
                    sender_id: sid,
                    number: mob,
                    amount: amt,
                    account: acNo,
                    beneficiaryid: bid,
                    channel: mode,
                    order_id: pid,
                    source: way
                },
                success: function (getResp) {
                    var success = getResp['success'];
                    var message = getResp['response']['message'];
                    var status = getResp['response']['status'];
                    var order_id = getResp['response']['order_id'];
                    var utr = getResp['response']['utr'];
                    var amount = getResp['response']['amount'];
                    //alert(success);

                    if (success == true) {
                        $("#transferBtn").attr('disabled', true);
                        $("#transferBtn").html(wait);
                        $("#trfWait").html('<div id="sweet">  <div class="table-responsive text-left"><table class="table"><tbody>' +
  '<tr><td>Response</td><td><small><b>' + message + '</b></small></td></tr>' +
  '<tr><td>Status</td><td>' + status + '</td></tr>' +
  '<tr><td>Refrence Id </td><td>#' + utr + '</td></tr>' +
  '<tr><td>Order Id </td><td>#' + order_id + '</td></tr>' +
  '<tr><td><b>Amount</b> </td><td> <i class="fas fa-rupee-sign"></i>' + amount + '</td></tr>' +
  '</tbody></table></div>' +
  '<div class="row"> <br />' +
  ' &nbsp; <a href="Dmt/index.php" style="color:#ffffff;" class="btn btn-default btn-sm">Close X</a>' +
  '</div></div>');
                    } else {

                        message = getResp['response']['message'];
                        //alert(message);
                        shtml = "Message: " + message;
                        pop('warning', shtml);
                        $("#transferBtn").attr('disabled', false);

                    }


                },
                error: function () {
                    alert("trans err");
                }
            });

            return false;

        });
        //end transfer



        //add beneficiary
        $("#addBene").submit(function () {

            var sid = $("#sID").val();
            var mob = $("#mobile").val();
            var name = $("#Name").val();
            var acc = $("#account").val();
            var ifsc = $("#ifsc").val();
            var parm = "api_token=" + tkn + "&mobile=" + mob + "&sender_id=" + sid + "&holdername=" + name + "&accountnumber=" + acc + "&ifsc=" + ifsc;

            $("#AddBene").html(wait);
            $("#AddBene").attr('disabled', true);
            //$("#transferBtn").attr('disabled',true);

            $.ajax({
                url: '../../app_v2/Dmt/add_beneficiary.php',
                method: 'POST',
                dataType: "json",
                data: parm,
                success: function (getResp) {
                    var success = getResp['success'];
                    var message = getResp['message'];
                    var status = getResp['status'];
                    var is_verified = getResp['is_verified'];
                    var sender_id = getResp['sender_id'];
                    var beneficiary_id = getResp['beneficiary_id'];

                    if (success == true) {
                        //push to
                        pop('success', 'Beneficiary Registered Successfully!');

                        GetSender(mob);
                        $("#AddBene").text('Add Beneficiary');
                        $('#Name,#account,#ifsc').val('');
                        $("#AddBene").attr('disabled', false);


                    } else {
                        //shtml="Message: "+message;
                        //pop('success',true,shtml);
                        alert(message);
                        $("#AddBene").text('Add Beneficiary');
                        enableAttrAddbene();
                    }


                },
                error: function () {
                    alert("add bene err");
                }
            });


            return false;
        });

    });

    function clickGetSender() {
        var mob = $("#number").val();
        if (mob.length == 10) {
            GetSender(mob);
            $("#GetSnd").attr('disabled', false);
        } else {
            $("#GetSnd").html(tryTen);
            $("#GetSnd").attr('disabled', true);
        }
    }

    function keyGetSender(num) {
        var numb = num.value;
        if (numb.length == 10) {
            GetSender(numb);
            //$("#GetSnd").attr('disabled',false);
        }
    }

    function GetSender(num) {
        var numb = num;
        $("#GetSnd,#number").attr('disabled', true);
        $("#GetSnd").html(process);

        //alert(1);
        //call ajax
        var payz = "api_token=" + tkn + "&mobile=" + numb;
        $.ajax({
            url: '../../app_v2/Dmt/get_customer.php',
            method: 'POST',
            dataType: "json",
            data: payz,
            success: function (getRp) {
                //on error
                var bol = getRp["success"];
                var name = getRp["name"];
                var sId = getRp["sender_id"];
                var cL = +getRp["consumed_limit"];
                var limiT = +getRp["limit"];
                var mobile = getRp["mobile"];
                var isVerify = getRp["is_verified"];
                var accounts = getRp["beneficiary"];
                var message = getRp["message"];

                //set cum limit
                $("#climit").text(cL);
                //t limit

                $("#tlimit").text(+cL + limiT);
                //remaning limit
                $("#rlimit").text(+limiT);
                //name
                $("#dsname").text(name);
                //mobile no
                $("#dsmobile").text(mobile);

                //verify sender
                if (bol == true & message == "OTP sent successfully") {

                    verifySender(sId, mobile, "NO");

                } else if (bol == true) {
                    //set to form
                    $("#BenADD").empty();
                    $("#sID").val(sId);
                    $("#mobile").val(mobile);
                    //on success

                    $("#content").hide();
                    $("#left_side,#right_side").show();
                    $.each(accounts, function (index, value) {
                        //fetch beneficicarys
                        var bId = value["beneficiary_id"];
                        var sttS = value["status"];
                        var repName = value["recipient_name"];
                        var bank = value["bank"];
                        var acc = value["account"];
                        var ifsc = value["ifsc"];
                        var mob = value["mobile"];
                        //alert(repName);
                        var elementz = btoa(bId + "#" + sttS + "#" + bank + "#" + acc + "#" + ifsc + "#" + mobile + "#" + repName + "#" + sId);
                        //for reverify
                        if (sttS == 0) {
                            var trFbtn = "<div class='col-md-5 text-right'><button class='btn btn-warning btn-sm'  disabled>Reverify Account</button> <button class='btn btn-danger btn-sm' id=" + bId + "del onclick='delBen(" + sId + "," + bId + ")'><i class='fa fa-trash'></i></button><div id=" + bId + "otp style='display:none'></div></div></div>";
                        } else {
                            var trFbtn = "<div class='col-md-5 text-right'><button class='btn btn-primary btn-sm'  onclick=trfD('" + elementz + "')>Transfer <i class='fas fa-location-arrow'></i></button> <button class='btn btn-danger btn-sm' id=" + bId + "del onclick='delBen(" + sId + "," + bId + ")'><i class='fa fa-trash'></i></button><div id=" + bId + "otp style='display:none'><input type='number' id=" + bId + "otpb class='form-control' name=" + bId + "otpb max-length='6'  placeholder='Enter OTP' onkeyup='confDel(" + sId + "," + bId + ",this.value)'/><button type='submit' id=" + bId + "Resend onclick='resend(" + sId + "," + bId + ")' class='btn btn-info btn-sm'>Resend &rightarrow;</button></div></div></div>";

                        }


                        $("#BenADD").append("<div class='col-md-12' id=" + bId + " style='border-bottom:1px solid #F2F2F2; padding: 5px 0;'><div class='row'><div class='col-md-6 text-left'><b>" + repName + "</b><br />" +
                           "<small>Bank Name:" + bank + "</small><br />" +
                           "<small>A/C:" + acc + "</small><br />" +
                           "<small>IFSC:" + ifsc + "</small></div>" + trFbtn);
                    });




                    $("#GetSnd").html(fetched);
                } else if (bol == false) {
                    //on error/not found create sender

                    createSender("NO");
                }
            },
            error: function (e) {
                alert('error');
            }

        });
        return false;

    }


    function trfD(v) {
        changeForm('trfMoney');
        var data = atob(v);
        var vals = data.split("#");
        var ac = vals[3];
        var baName = vals[2];
        var benName = vals[6];
        var benId = vals[0];
        var sId = vals[7];
        var mob = vals[5];
        $("#accountNo").val(ac);
        $("#bankName").val(baName);
        $("#benName").val(benName);
        $("#sID").val(sId);
        $("#benID").val(benId);
        $("#mobile").val(mob);
        $("input").attr('readonly', true);
        $("#amounT,#camounT").attr('readonly', false);
        $("html,body").animate({ scrollTop: 100 }, 1000);
    }

    //delete beneficiery
    function delBen(sId, benId) {
        $("#" + benId + "otpb").attr('readonly', false);
        $("#" + benId + "del").html(wait);
        var pDel = "api_token=" + tkn + "&sender_id=" + sId + "&beneficiaryid=" + benId;
        //alert(pDel);
        $.ajax({
            url: '../../app_v2/Dmt/deleteBeneficiary.php',
            method: 'POST',
            dataType: "json",
            data: pDel,
            success: function (getRp) {
                pop('success', 'OTP Sent Successfully!');

                if (getRp['success'] == true) {

                    $("#" + benId + "del").hide();
                    $("#" + benId + "otp").show(1000);
                    $("button").attr('disabled', true);
                    $("#" + benId + "Resend", "#" + benId + "otp", "#" + benId + "otpb").attr('disabled', false);
                    $("#" + benId + "otpb").attr({ 'disabled': false, 'placeholder': 'Enter OTP' });


                } else {
                    //show message and disable
                    $("#" + benId + "del").attr('disabled', true);
                    $("#" + benId + "del").html(getRp['message']);
                    pop('success', getRp['message']);
                }

            },
            error: function () {
                alert("del err");
            }
        });

    }

    //conform delete
    function confDel(sid, bid, otp) {

        if (otp.length >= 6) {
            $("#" + bid + "otpb").attr('disabled', true);

            $("#" + bid + "Resend").html(wait);
            var cDel = "api_token=" + tkn + "&sender_id=" + sid + "&beneficiaryid=" + bid + "&otp=" + otp;
            $.ajax({
                url: '../../app_v2/Dmt/delete_beneficiary_confirm.php',
                method: 'POST',
                dataType: "json",
                data: cDel,
                success: function (getRp) {

                    if (getRp["success"] == true) {
                        $("button").attr('disabled', false);
                        $("#" + bid).html("Beneficiary Deleted");
                        $("#" + bid).hide(5000);
                        pop('success', 'Beneficiary Deleted Successfully!');
                    } else if (getRp["success"] == false & getRp["message"] == "OTP invalid") {
                        $("#" + bid + "otpb").val('');
                        $("#" + bid + "otpb").attr({ 'disabled': false, 'placeholder': 'Wrong OTP' });
                        $("#" + bid + "otpb").css('border-color', '#FF0000');
                        $("#" + bid + "Resend").html("Resend");
                        $("#" + bid + "Resend").attr('disabled', false);
                        Swal.fire({
                            type: 'warning',
                            text:
                              'Wrong OTP entered!',
                            timer: 2000,
                            showConfirmButton: false,
                        });
                    }
                },
                error: function () {
                    alert("del conf err");
                }
            });
        }

    }


    //resend otp
    function resend(sid, bid) {
        delBen(sid, bid);
        $("#" + bid + "otpb").attr({ 'disabled': false, 'placeholder': 'Enter OTP' });
        var count = 30;
        var btnRend = setInterval(function () {
            --count;
            if (count == -1) {
                $("#" + bid + "Resend").attr('disabled', false);
                $("#" + bid + "Resend").text('Resend');
                clearInterval(btnRend);

            } else {
                $("#" + bid + "Resend").text('Wait ' + count + ' Seconds');
                $("#" + bid + "Resend").attr('disabled', true);
            }

        }, 1000);

    }

    function enableAttrAddbene() {
        $("#Name,#ifsc,#account,#AddBene").attr('disabled', false);
        $("#ifsc").val("");
    }


    //change form
    function changeForm(val) {

        if (val.value == "addBene") {
            $("#" + val.value).show(1000);
            $("#trfMoney").hide();
            $("#lbanks").hide();
        } else if (val.value == "trfMoney") {
            $("#addBene").hide();
            $("#" + val.value).show(1000);
        } else {
            $("#addBene").hide();
            $("#" + val).show(1000);
            $("#getForm").val();
        }

    }

    //verify sender
    function verifySender(sid, mob, otp) {

        if (otp == "NO") {
            $("#number").attr('disabled', true);
            $(".otp-field").show('1000');
            $(".GetSnd").hide();
            $(".verifyUser").show();
            $("#senderId").val(sid);
        } else if (otp.length == 6) {//6 digit otp
            //disable otp field
            $("#senderOtp").attr('disabled', true);
            var userSid = $("#senderId").val();
            var userMob = $("#number").val();
            $("#verifyUser").html(wait);

            var vusr = "api_token=" + tkn + "&mobile=" + userMob + "&sender_id=" + userSid + "&otp=" + otp;
            //alert(pDel);
            $.ajax({
                url: '../../app_v2/Dmt/verify_sender.php',
                method: 'POST',
                dataType: "json",
                data: vusr,
                success: function (getRp) {
                    var verfy = getRp['is_verified'];
                    var msg = getRp['message'];

                    if (getRp['success'] == true) {


                        //push to
                        GetSender(userMob);

                        //alert(msg);

                    } else {

                        //alert(msg);
                        $("#senderOtp").val('');
                        $("#senderOtp").attr('disabled', false);
                        $("#senderOtp").attr('placeholder', 'Invalid OTP');
                        pop('warning', msg);
                        $("#verifyUser").text("Verify Sender");
                    }

                },
                error: function () {
                    alert("otp ver user err");
                }
            });

        }

    }

    //create sender
    function createSender(v) {
        if (v == "NO") {
            $(".SenderSurname,.SenderName,.createNewSender").show(1000);
            $(".GetSnd").hide();
        } else if (v == "YES") {
            var surname = encodeURIComponent($("#SenderSurname").val());
            var name = encodeURIComponent($("#SenderName").val());
            var userMob = $("#number").val();
            var csnd = "api_token=" + tkn + "&mobile=" + userMob + "&name=" + name + "&surname=" + surname;
            $("#createNewSender").html(wait);
            $("#createNewSender").attr('disabled', true);
            //alert(csnd);
            $.ajax({
                url: '../../app_v2/Dmt/add_sender.php',
                method: 'POST',
                dataType: "json",
                data: csnd,
                success: function (getRp) {
                    var stts = getRp['success'];
                    var ver = getRp['is_verified'];
                    var sid = getRp['sender_id'];
                    var Msg = getRp['message'];
                    //alert(stts);
                    if (stts == true & ver == 0) {
                        //verify
                        verifySender(sid, 0, 'NO');
                        $(".createNewSender").hide();
                        $("#SenderName,#SenderSurname").attr('disabled', true);
                        pop('success', 'OTP sent successfully!');

                    } else if (stts == true & ver == 1) {
                        //alredy verifyed
                        pop('warning', '' + Msg + '');
                    }
                    else {
                        // status false
                        pop('warning', '' + Msg + '');
                        $("#createNewSender").html('Try Again...');
                        $("#createNewSender").attr('disabled', false);
                    }

                },
                error: function (q, b) {
                    alert("err create sender" + b);
                }
            });
        }
    }

    //set ifsc
    function setIfsc(ak) {
        if (ak == 'NO') {
            alert("Select Bank");
        } else if (ak == '' || ak == '0') {
            pop('warning', 'Service Not Avalible For selected bank');
        }
        else {
            $("#ifsc").val(ak);
        }
    }
</script>